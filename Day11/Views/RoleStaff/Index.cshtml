
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="~/Scripts/jquery-3.4.1.js"></script>
    <link href="~/Content/layui-v2.5.7/layui/css/layui.css" rel="stylesheet" />
    <script src="~/Content/layui-v2.5.7/layui/layui.js"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
    <div class="layui-btn-container">

    </div>
    <table>
        <tr>
            <td valign="top">
                <div id="test12" class="demo-tree-more"></div>
            </td>
            <td>
                <button type="button" class="layui-btn layui-btn-sm" lay-demo="getChecked">添加</button>
                当前角色:<span id="lblRoleName"></span> <input type="hidden" id="hdRoleId" value="0" />
                <table class="layui-hide" id="test" lay-filter="demo"></table>
                
            </td>
        </tr>
    </table>


    <script>
        layui.use(['tree', 'table'], function () {
            var tree = layui.tree
                , layer = layui.layer
                , util = layui.util

            ////按钮事件
            //util.event('lay-demo', {
            //    getChecked: function () {
            //        var checkedData = tree.getChecked('demoId2'); //获取选中节点的数据

            //        var ids = getCheckedId(checkedData)
            //        var roleId = $("#hdRoleId").val();
            //        alert(roleId);
            //        alert(menusIds);
            //        $.ajax({
            //            url: '/RoleOne/AddRoleTwo',
            //            type: 'get',
            //            data: { roleId: roleId, menuIds: menusIds },
            //            success:
            //                function (d) {
            //                    if (d > 0) {
            //                        layer.msg("保存成功");
            //                    }
            //                    else {
            //                        layer.msg("保存失败");
            //                    }
            //                }
            //        })
            //    }

            //});
            var table = layui.table;
            table.render({
                elem: '#test'
                , url: '/RoleStaff/GetRoleStaffList'
                , cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                , id: 'testReload'
                , cols: [[
                    , { field: 'Id', width: 80, title: 'ID' }
                    , { field: 'UserID', width: 80, title: '用户账号' }
                    , { field: 'UserName', width: 80, title: '用户名' }
                    , { field: 'DeptName', width: 80, title: '部门名称' }
                    , { field: 'Email', width: 80, title: '联系方式' }
                    , { title: '操作', fixed: 'right', align: 'center', toolbar: '#barDemo' }
                ]]
            });
            
            tree.render({
                elem: '#test12'
                , data: GetRoleData()
                , id: 'demoId1'
                , click: function (obj) {
                    $("#lblRoleName").html(obj.data.title);
                    alert(obj.data.id);
                    layui.table.reload('testReload', {
                        where: {
                            roleId: obj.data.id
                        }

                    }, 'data')
                }
            });



        });
        function getCheckedId(data) {
            var id = "";
            $.each(data, function (index, item) {
                if (id != "") {
                    id = id + "," + item.id;
                }
                else {
                    id = item.id;
                }
                //item 没有children属性
                if (item.children != null) {
                    var i = getCheckedId(item.children);
                    if (i != "") {
                        id = id + "," + i;
                    }
                }
            });
            return id;
        }
            //基本演示
        function GetRoleData() {
            var result = [];
            $.ajax({
                url: '/RoleOne/GetRole',
                type: 'get',
                dataType: 'json',
                async: false,
                success:
                    function (d) {
                        result = d;
                    }
            })
            return result;
        }
        function GetMenusData() {
            var result = [];
            $.ajax({
                url: '/RoleOne/GetMenus',
                type: 'get',
                dataType: 'json',
                async: false,
                success:
                    function (d) {
                        result = d;
                    }
            })
            return result;
        }

        function GetMenusIds(roleid) {
            var result = "";
            $.ajax({
                url: '/RoleOne/GetMenusIds',
                type: 'get',
                dataType: 'json',
                data: { roleId: roleid },
                async: false,
                success:
                    function (data) {
                        result = data;
                    }
            })
            return result;
        }
    </script>

</body>
</html>